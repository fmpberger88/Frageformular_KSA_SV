library(shiny)
library(shinythemes)
library(dplyr)
library(knitr)
library(kableExtra)

# Define the UI
ui <- fluidPage(
  
  # App title
  titlePanel("My Shiny App"),
  
  # Set the theme
  theme = shinytheme("flatly"),
  
  # Form inputs
  sidebarLayout(
    sidebarPanel(
      textInput(inputId = "name", label = "Name"),
      numericInput(inputId = "age", label = "Age"),
      selectInput(inputId = "gender", label = "Gender", choices = c("Male", "Female", "Other")),
      textInput(inputId = "email", label = "Email"),
      actionButton(inputId = "submit", label = "Submit")
    ),
    
    # Display the thank you message
    mainPanel(
      conditionalPanel(condition = "input.submit > 0",
                       h2("Thank you for your submission!")),
      downloadButton(outputId = "downloadPDF", label = "Download PDF")
    )
  )
)

# Define the server
server <- function(input, output) {
  
  # Create a reactive object to store the form data
  formData <- reactive({
    data.frame(Name = input$name,
               Age = input$age,
               Gender = input$gender,
               Email = input$email)
  })
  
  # Download the PDF
  output$downloadPDF <- downloadHandler(
    filename = function() {
      paste0(input$name, "_responses.pdf")
    },
    content = function(file) {
      pdf_file <- file.path(tempdir(), "responses.pdf")
      rmarkdown::render(
        input = "responses.Rmd",
        output_format = "pdf_document",
        output_file = pdf_file,
        params = list(data = formData())
      )
      file.copy(pdf_file, file)
    }
  )
}

# Run the app
shinyApp(ui, server)